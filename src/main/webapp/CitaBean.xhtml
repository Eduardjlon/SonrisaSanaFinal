<ui:composition template="/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:define name="content">
        <h2>Agenda de Citas</h2>

        <!-- MENSAJES -->
        <h:form id="global">
            <p:growl id="msgs" showDetail="true" showSummary="true" globalOnly="true"/>
        </h:form>

        <!-- CALENDARIO -->
        <h:form id="frmAgenda">
            <p:schedule id="agenda"
                        value="#{citaBean.eventModel}"
                        timeZone="America/Guatemala"
                        locale="es"
                        widgetVar="agendaWidget"
                        draggable="false"
                        resizable="false"
                        allDaySlot="false"
                        slotDuration="00:30"
                        view="agendaWeek"
                        minHour="7"
                        maxHour="20">

                <p:ajax event="eventSelect"
                        listener="#{citaBean.onEventSelect}"
                        update=":dlgCita"
                        oncomplete="PF('dlgCita').show();"/>
            </p:schedule>
        </h:form>

        <!-- DIALOGO DE CITA -->
        <p:dialog id="dlgCita"
                  header="Detalle de Cita"
                  widgetVar="dlgCita"
                  modal="true"
                  resizable="false"
                  width="500"
                  styleClass="dialog-elegante">

            <h:form id="frmCita" style="padding:10px">

                <p:panelGrid columns="1" style="width:100%">

                    <p:outputLabel value="Paciente"/>
                    <p:inputText value="#{citaBean.cita.paciente.nombreCompleto}" readonly="true"/>

                    <p:outputLabel value="OdontÃ³logo"/>
                    <p:inputText value="#{citaBean.cita.odontologo.nombreCompleto}" readonly="true"/>

                    <p:outputLabel value="Tratamiento"/>
                    <p:inputText value="#{citaBean.cita.tratamiento.nombre}" readonly="true"/>

                    <p:outputLabel value="Fecha y Hora"/>
                    <p:inputText value="#{citaBean.fechaCompleta}" readonly="true"/>

                    <p:outputLabel value="Estado"/>
                    <p:inputText value="#{citaBean.cita.estado}" readonly="true"
                                 style="font-weight:bold; color:#{citaBean.cita.estado eq 'PENDIENTE' ? 'red' : citaBean.cita.estado eq 'CONFIRMADA' ? 'green' : 'gray'}"/>
                </p:panelGrid>

                <div style="margin-top:15px; display:flex; justify-content:flex-end; gap:12px;">
                    <!-- BOTON CONFIRMAR -->
                    <p:commandButton value="CONFIRMAR"
                                     rendered="#{citaBean.odonto}"
                                     actionListener="#{citaBean.confirmarCita}"
                                     update=":frmAgenda:agenda, :global:msgs"
                                     styleClass="p-button-success"
                                     oncomplete="PF('dlgCita').hide();"/>

                    <!-- BOTON CANCELAR -->
                    <p:commandButton value="CANCELAR"
                                     rendered="#{citaBean.odonto}"
                                     actionListener="#{citaBean.cancelarCita}"
                                     update=":frmAgenda:agenda, :global:msgs"
                                     styleClass="p-button-secondary"
                                     oncomplete="PF('dlgCita').hide();"/>

                    <!-- CERRAR DIALOGO -->
                    <p:commandButton value="Cerrar"
                                     type="button"
                                     onclick="PF('dlgCita').hide();"/>
                </div>

            </h:form>

        </p:dialog>

    </ui:define>
</ui:composition>
